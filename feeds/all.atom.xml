<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>blog.airey.be</title><link href="https://blog.airey.be/" rel="alternate"></link><link href="https://blog.airey.be/feeds/all.atom.xml" rel="self"></link><id>https://blog.airey.be/</id><updated>2018-09-11T23:11:00+02:00</updated><entry><title>Time Management for System Administrators</title><link href="https://blog.airey.be/time-management-for-SAs.html" rel="alternate"></link><published>2018-09-11T00:54:00+02:00</published><updated>2018-09-11T16:30:00+02:00</updated><author><name>Andy Airey</name></author><id>tag:blog.airey.be,2018-09-11:/time-management-for-SAs.html</id><summary type="html">&lt;p&gt;Review and takeaways on the great book Time Management for System Administrators by Simon Limoncelli, published by&amp;nbsp;O&amp;#8217;Reilly.&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="O'Reilly Book Cover \&amp;lt;" src="images/time-management.png"&gt;&lt;/p&gt;
&lt;p&gt;After &lt;em&gt;4 years&lt;/em&gt; I finally made enough time to finish reading this&amp;nbsp;book.&lt;/p&gt;
&lt;p&gt;Sounds Ironic, no? Just goes to show how bad I needed some proper Time&amp;nbsp;Management.&lt;/p&gt;
&lt;p&gt;By time I fully read it, I felt I had come up with some of the proposed techniques already throughout my (young) career myself, gained through experience.&lt;br&gt;
Throughout the years, I&amp;#8217;ve always embraced Continuous Improvement and managing your time well is nefarious to this&amp;nbsp;concept.&lt;/p&gt;
&lt;p&gt;So in this post, I will list my personal takeaways from the book - there might be much more in it to discover for yourself.&lt;br&gt;
Although some proposed solutions may sound obvious for some people, I can&amp;#8217;t recommend this book enough for System Adminstrators and even SysOps/&lt;span class="caps"&gt;SRE&lt;/span&gt; roles.&lt;br&gt;
Whether you are just starting out your career or if you are facing issues managing your time properly.&lt;br&gt;
Even these days with Agile and DevOps, some parts still make complete sense - or you can easily project it on the current&amp;nbsp;times.&lt;/p&gt;
&lt;p&gt;This is the first time I write a &amp;#8220;book review&amp;#8221;, but as you can see it will be more a summary of my personal notes.&lt;br&gt;
It&amp;#8217;s a list of things that the book covered which resonated for me, might be different for&amp;nbsp;you.&lt;/p&gt;
&lt;p&gt;I will go over chapter by chapter and list my personal takeaways for each of&amp;nbsp;them.&lt;/p&gt;
&lt;h2&gt;Focus vs&amp;nbsp;Interruption&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Have an immutable&amp;nbsp;coworker.&lt;/li&gt;
&lt;li&gt;Dealing with interruptions: &lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Delegate it&lt;/strong&gt;: have someone else do it if you are in the middle of&amp;nbsp;something&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Record it&lt;/strong&gt;: Write it down (create a ticket), notify the person that a ticket is created (preferably while he is still next to&amp;nbsp;you)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Do it&lt;/strong&gt;: If it is truly urgent, drop everything and just do&amp;nbsp;it.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Plan project stuff during peak focus&amp;nbsp;time.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Routines&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Create Routines (weekly), fill up gas tank on sunday, walk-around the office on Mo &lt;span class="amp"&gt;&amp;amp;&lt;/span&gt; Thu, schedule a weekly chat with your boss&amp;nbsp;&amp;#8230;&lt;/li&gt;
&lt;li&gt;Always backup a file before&amp;nbsp;editing&lt;/li&gt;
&lt;li&gt;Schedule reading&amp;nbsp;time&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;&lt;span class="dquo"&gt;&amp;#8220;&lt;/span&gt;The Cycle&amp;nbsp;System&amp;#8221;&lt;/h2&gt;
&lt;p&gt;Daily to-do list with columns Done, Priority, Time, Item.&lt;br&gt;
Only 3 priority levels: &lt;em&gt;A&lt;/em&gt; (today), &lt;em&gt;B&lt;/em&gt; (soon), &lt;em&gt;C&lt;/em&gt; (everything&amp;nbsp;else)&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Done&lt;/th&gt;
&lt;th&gt;Priority&lt;/th&gt;
&lt;th&gt;Time&lt;/th&gt;
&lt;th&gt;Item&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;td&gt;A&lt;/td&gt;
&lt;td&gt;1h&lt;/td&gt;
&lt;td&gt;Fix Jenkins build for product x&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;A&lt;/td&gt;
&lt;td&gt;1h&lt;/td&gt;
&lt;td&gt;Deploy new webserver for product y&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;B&lt;/td&gt;
&lt;td&gt;3h&lt;/td&gt;
&lt;td&gt;Try out molecule on an Ansible role&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;Record all requests, every time. Use your brain for other&amp;nbsp;stuff.&lt;/li&gt;
&lt;li&gt;Similarly, write down thoughts immediately to clear&amp;nbsp;mind&lt;/li&gt;
&lt;li&gt;10 minutes every morning to plan today&amp;#8217;s todo list, before opening your&amp;nbsp;mail!&lt;/li&gt;
&lt;li&gt;Block timeslot on high concentration and energy part of the day to do project&amp;nbsp;work&lt;/li&gt;
&lt;li&gt;Items that were not done Yesterday, keep getting added to the list of Today until done (during daily review in the&amp;nbsp;morning)&lt;/li&gt;
&lt;li&gt;Let people know you were not able to finish their request by the end of the&amp;nbsp;day&lt;/li&gt;
&lt;li&gt;When new tasks get added during the day, add them to tomorrows schedule or reshuffle today (allow for 1h interruption&amp;nbsp;time)&lt;/li&gt;
&lt;li&gt;21 days needed to create a&amp;nbsp;habit.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Life&amp;nbsp;Goals&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;To achieve your long-term goals, you need to know what they are and work toward&amp;nbsp;them&lt;/li&gt;
&lt;li&gt;Goals should be measurable, they need a tangible result or&amp;nbsp;measurement&lt;/li&gt;
&lt;li&gt;Goals should have&amp;nbsp;deadines&lt;/li&gt;
&lt;li&gt;Review your life goals on a monthly basis with the following&amp;nbsp;table:&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;Professional&lt;/th&gt;
&lt;th&gt;Personal&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1 month&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1 year&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5 years&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;Add goals and steps to achieve such goal to the table, these &amp;#8220;next steps&amp;#8221; can then be sprinkled over your regular ToDo&amp;nbsp;list.&lt;/li&gt;
&lt;li&gt;Schedule this &amp;#8220;Life Goal Review&amp;#8221; on the first monday of every month for example, dedicate time to it behind a closed door.&lt;br&gt;
  Add new ones and eliminate old&amp;nbsp;ones.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Prioritization&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;First task on list gets done first (oldest), no time wasted picking a&amp;nbsp;task&lt;/li&gt;
&lt;li&gt;Based on customer expectation, blocking factor.&lt;br&gt;
  A small task that blocks a customer&amp;#8217;s project will cost you the same amount of time to do it. The moment &lt;em&gt;when&lt;/em&gt; you do it becomes important&amp;nbsp;here.&lt;/li&gt;
&lt;li&gt;For project: high-impact projects get priority over smaller non-impacting projects, they benefit you more than smaller easy&amp;nbsp;projects&lt;/li&gt;
&lt;li&gt;Requests from boss get a higher priority, don&amp;#8217;t be the reason he is&amp;nbsp;delayed.&lt;/li&gt;
&lt;li&gt;&lt;span class="dquo"&gt;&amp;#8220;&lt;/span&gt;Manage your Boss&amp;#8221;: Understand his goals, &lt;span class="caps"&gt;KPI&lt;/span&gt;&amp;#8217;s and contribute to&amp;nbsp;them&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Stress&amp;nbsp;Management&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Use vacation for decent breaks (save up for a 3-week&amp;nbsp;break)&lt;/li&gt;
&lt;li&gt;Look into Yoga, meditation, massage (back muscles get tense from&amp;nbsp;stress)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;E-mail&amp;nbsp;Management&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Go for a Clean&amp;nbsp;Inbox&lt;/li&gt;
&lt;li&gt;Similar to &amp;#8220;Delegate, Record, Do&amp;#8221;: &lt;ul&gt;
&lt;li&gt;Filter&lt;/li&gt;
&lt;li&gt;Delete&amp;nbsp;Unread&lt;/li&gt;
&lt;li&gt;Read and &amp;#8230;&lt;ul&gt;
&lt;li&gt;Delete&lt;/li&gt;
&lt;li&gt;File&lt;/li&gt;
&lt;li&gt;Reply, then&amp;nbsp;delete&lt;/li&gt;
&lt;li&gt;Delegate or forward, then&amp;nbsp;delete&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Don&amp;#8217;t re-read an e-mail! Once you start reading it, finish it and take one of the above&amp;nbsp;actions.&lt;/li&gt;
&lt;li&gt;Don&amp;#8217;t use your inbox/mail system as an organizer, you have your To Do list for&amp;nbsp;that&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Time-wasters&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;A time waster is any activity that has low ratio of benefit to time spent.
  Rather than trying to do these activities more efficiently, it is better to try to eliminate&amp;nbsp;them.&lt;/li&gt;
&lt;li&gt;Certain activities require to set an alarm so we are able to snap out of it before it eats all our time. (let me check this for 5 minutes &amp;#8230; actually limit yourself and set an&amp;nbsp;alarm)&lt;/li&gt;
&lt;li&gt;Differentiate between a work meeting vs status meeting, make it clear in the&amp;nbsp;invite&lt;/li&gt;
&lt;li&gt;Start meetings on time, start with the most important items. Point latecomers to the&amp;nbsp;minutes.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Documentation&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Internal and public repository, available through a web&amp;nbsp;page.&lt;/li&gt;
&lt;li&gt;Create and link &lt;span class="caps"&gt;IT&lt;/span&gt; policies, only when&amp;nbsp;available&lt;/li&gt;
&lt;li&gt;Also link to &lt;span class="caps"&gt;HR&lt;/span&gt; and Legal&amp;nbsp;policies.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Automation&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Makefile on each server that does the actions you usually need to do&amp;nbsp;there&lt;/li&gt;
&lt;li&gt;Before we can automate something, we need to have done it manually first to understand the full process, then document it step-by-step, then automate&amp;nbsp;it&lt;/li&gt;
&lt;li&gt;Automate a task one step at a time and test in between (like crafting a&amp;nbsp;oneliner)&lt;/li&gt;
&lt;li&gt;4 kinds of tasks:&lt;ul&gt;
&lt;li&gt;Simple Things Done&amp;nbsp;once&lt;/li&gt;
&lt;li&gt;Simple Things Done&amp;nbsp;often&lt;/li&gt;
&lt;li&gt;Hard Things Done&amp;nbsp;once&lt;/li&gt;
&lt;li&gt;Hard Things Done&amp;nbsp;often&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;Simple Things&lt;/th&gt;
&lt;th&gt;Hard Things&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Done Once&lt;/td&gt;
&lt;td&gt;Do it manually&lt;/td&gt;
&lt;td&gt;Automate it&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Done Often&lt;/td&gt;
&lt;td&gt;Automate it&lt;/td&gt;
&lt;td&gt;Buy or Write Software&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1&gt;Some personal thoughts on the&amp;nbsp;book&lt;/h1&gt;
&lt;p&gt;In this book, some information may come across as dated, &amp;#8220;Using pen and paper or a &lt;span class="caps"&gt;PDA&lt;/span&gt;. What?&amp;#8221;&lt;br&gt;
But I highly recommend you sit it through and translate it to modern equivalents. Not that much has changed as it may&amp;nbsp;seem.&lt;/p&gt;
&lt;p&gt;For example, the Makefile per server sounds a bit old-fashioned in a world of containers, orchestrators and serverless.&lt;br&gt;
With no &lt;span class="caps"&gt;SSH&lt;/span&gt; access a Makefile could still be interesting&amp;nbsp;though.&lt;/p&gt;
&lt;p&gt;Say you have different products and you need to scale up or scale down this products services. You could have a generic set of tasks per product that calls &lt;code&gt;aws-cli&lt;/code&gt;, &lt;code&gt;kubectl&lt;/code&gt; or &lt;code&gt;ansible&lt;/code&gt; underneath, depending on what kind of stack it is running&amp;nbsp;on.&lt;/p&gt;
&lt;p&gt;You could also look at this book as a &amp;#8220;&lt;a href="https://gettingthingsdone.com/"&gt;&lt;span class="caps"&gt;GTD&lt;/span&gt;&lt;/a&gt; for sysadmins&amp;#8221;, while somewhat true it still has it&amp;#8217;s purpose and helps to relate to the mentioned problems and solutions&amp;nbsp;thereof.&lt;/p&gt;
&lt;p&gt;For better E-mail management, I think the tips are great as we get overloaded by mailing list messages, &lt;span class="caps"&gt;JIRA&lt;/span&gt; notifications, trello board updates &amp;#8230;&lt;br&gt;
I think I would go even further and restrict myself to do some inbox cleaning (reading mail) only once a day, say, after lunch.
E-mail is not that urgent usually - we have &lt;span class="caps"&gt;IM&lt;/span&gt; for that, which this book sadly does not cover&amp;nbsp;:-).&lt;/p&gt;</content><category term="lifehacks"></category><category term="productivity"></category><category term="notes"></category></entry><entry><title>Wireguard Setup on Fedora</title><link href="https://blog.airey.be/wireguard-setup.html" rel="alternate"></link><published>2018-09-10T21:49:00+02:00</published><updated>2018-09-11T23:11:00+02:00</updated><author><name>Andy Airey</name></author><id>tag:blog.airey.be,2018-09-10:/wireguard-setup.html</id><summary type="html">&lt;p&gt;How To setup and use Wireguard on Fedora Workstation as client and Fedora Server as PtP and &lt;span class="caps"&gt;VPN&lt;/span&gt; server. Also covers the setup on&amp;nbsp;Android&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="WireGueard logo" src="images/wireguard.png"&gt;&lt;/p&gt;
&lt;p&gt;Ever since Linus Torvalds &lt;a href="http://lkml.iu.edu/hypermail/linux/kernel/1808.0/02472.html"&gt;praised&lt;/a&gt; Wireguard, I&amp;#8217;ve been wanting to try it out.&lt;br&gt;
Last week I finally got around to play with it, and boy was it easy and elegant to set&amp;nbsp;up.&lt;/p&gt;
&lt;p&gt;It was really easy to set up, it took me longer to write this blog post than to set up wireguard on 3&amp;nbsp;peers.&lt;/p&gt;
&lt;p&gt;I used a Fedora Server as a first endpoint and my Fedora Workstation as a second endpoint.&lt;br&gt;
Later on I also easily added my Android phone as a third endpoint, and set up the Fedora Server as a &lt;span class="caps"&gt;VPN&lt;/span&gt; server (routing traffic to the internal and external&amp;nbsp;networks).&lt;/p&gt;
&lt;p&gt;Let me walk you through the setup&amp;nbsp;steps.&lt;/p&gt;
&lt;h1&gt;Installation&lt;/h1&gt;
&lt;p&gt;We need to install wireguard first as it is not yet part of the mainline&amp;nbsp;kernel.&lt;/p&gt;
&lt;p&gt;On the Fedora Server and&amp;nbsp;Workstation:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo dnf copr &lt;span class="nb"&gt;enable&lt;/span&gt; jdoss/wireguard
sudo dnf install wireguard-dkms wireguard-tools
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;Setting up the&amp;nbsp;endpoints&lt;/h1&gt;
&lt;p&gt;As you will see below the setup is very similar for both endpoints.&lt;br&gt;
Note the difference in &lt;span class="caps"&gt;IP&lt;/span&gt;&amp;nbsp;addresses.&lt;/p&gt;
&lt;p&gt;We will choose a static tunnel &lt;span class="caps"&gt;IP&lt;/span&gt; per host in the 10.0.0.0/24 range, but it could be any range of your&amp;nbsp;choosing.&lt;/p&gt;
&lt;p&gt;Create a keypair on each&amp;nbsp;host:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;wg genkey &amp;gt; private
wg pubkey &amp;lt; private
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Take note of the public key to configure your other client later&amp;nbsp;on.&lt;/p&gt;
&lt;h2&gt;First&amp;nbsp;peer&lt;/h2&gt;
&lt;p&gt;Our first endpoint has a private &lt;span class="caps"&gt;IP&lt;/span&gt; address of 192.168.2.1/24 on enp2s0, adapt it to match your machine&amp;#8217;s private &lt;span class="caps"&gt;IP&lt;/span&gt;&amp;nbsp;address.&lt;/p&gt;
&lt;p&gt;Interface&amp;nbsp;Settings:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ip link add dev wg0 &lt;span class="nb"&gt;type&lt;/span&gt; wireguard
ip address add dev wg0 &lt;span class="m"&gt;10&lt;/span&gt;.0.0.1/24
wg &lt;span class="nb"&gt;set&lt;/span&gt; wg0 listen-port &lt;span class="m"&gt;51820&lt;/span&gt; private-key ./private
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Peer&amp;nbsp;Settings:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;wg &lt;span class="nb"&gt;set&lt;/span&gt; wg0 peer &amp;lt;peer2-public-key&amp;gt; allowed-ips &lt;span class="m"&gt;10&lt;/span&gt;.0.0.2/32 endpoint &amp;lt;peer2-pulic-ip&amp;gt;:51820
ip link &lt;span class="nb"&gt;set&lt;/span&gt; wg0 up
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The &lt;code&gt;allowed-ips&lt;/code&gt; setting denotes what network lies at the other end of the tunnel.&lt;br&gt;
Routes will automatically be set up towards these networks when the interface becomes active.&lt;br&gt;
As a starting point we can use the other peer&amp;#8217;s tunnel &lt;span class="caps"&gt;IP&lt;/span&gt;&amp;nbsp;address.&lt;/p&gt;
&lt;h2&gt;Second&amp;nbsp;peer&lt;/h2&gt;
&lt;p&gt;Interface&amp;nbsp;Settings:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ip link add dev wg0 &lt;span class="nb"&gt;type&lt;/span&gt; wireguard
ip address add dev wg0 &lt;span class="m"&gt;10&lt;/span&gt;.0.0.2/24
wg &lt;span class="nb"&gt;set&lt;/span&gt; wg0 listen-port &lt;span class="m"&gt;51820&lt;/span&gt; private-key ./private
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Peer&amp;nbsp;Settings:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;wg &lt;span class="nb"&gt;set&lt;/span&gt; wg0 peer &amp;lt;peer2-public-key&amp;gt; allowed-ips &lt;span class="m"&gt;10&lt;/span&gt;.0.0.1/24 endpoint &amp;lt;peer1-pulic-ip&amp;gt;:51820
ip link &lt;span class="nb"&gt;set&lt;/span&gt; wg0 up
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Check&amp;nbsp;connectivity&lt;/h2&gt;
&lt;p&gt;At this point you should be able to ping the other endpoint his 10.0.0.x address after the interface is&amp;nbsp;up.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;wg&lt;/code&gt; command should show you some useful output as&amp;nbsp;well.&lt;/p&gt;
&lt;p&gt;Remember when doing tcpdump and forwarding ports, the connection is over &lt;span class="caps"&gt;UDP&lt;/span&gt;, not &lt;span class="caps"&gt;TCP&lt;/span&gt;!&lt;br&gt;
Hint if you run with firewalld enabled: &lt;code&gt;firewall-cmd --add-port 51820/udp&lt;/code&gt;, see Additional Settings below to do this&amp;nbsp;automatically.&lt;/p&gt;
&lt;h2&gt;&lt;span class="caps"&gt;NAT&lt;/span&gt; and Dynamic endpoint &lt;span class="caps"&gt;IP&lt;/span&gt;&amp;nbsp;address&lt;/h2&gt;
&lt;p&gt;If you are, like me, trying to set up your laptop to connect to a remote server, your public &lt;span class="caps"&gt;IP&lt;/span&gt; will most definitely change a&amp;nbsp;lot.&lt;/p&gt;
&lt;p&gt;The solution to this is to use Dynamic &lt;span class="caps"&gt;DNS&lt;/span&gt; and use this &lt;span class="caps"&gt;DNS&lt;/span&gt; name in your endpoint configuration.&lt;br&gt;
Even on Android &lt;a href="https://play.google.com/store/apps/details?id=com.icecoldapps.dynamicdnsupdate"&gt;there is an app for that&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Also, there is a setting called &lt;code&gt;persistent-keepalive&lt;/code&gt; that will assist firewalls to keep the tunnel&amp;nbsp;alive.&lt;/p&gt;
&lt;h2&gt;Persistent&amp;nbsp;configuration&lt;/h2&gt;
&lt;p&gt;The &lt;span class="caps"&gt;CLI&lt;/span&gt; tools are nice and all, but I want the &lt;span class="caps"&gt;VPN&lt;/span&gt; link to come up with my Fedora Server and easily bring up the connection with one commmand on my&amp;nbsp;Workstation.&lt;/p&gt;
&lt;p&gt;No problem, &lt;code&gt;wg-quick&lt;/code&gt; has got you&amp;nbsp;covered.&lt;/p&gt;
&lt;p&gt;First export the current config to a file, link it to the device and enable the systemd service (if you want to bring the device up at boot&amp;nbsp;time).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;wg showconf &amp;gt; /etc/wiregaurd/wg0.conf
chmod &lt;span class="m"&gt;700&lt;/span&gt; /etc/wireguard/wg0.conf
wg setconf wg0 /etc/wireguard/wg0.conf
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;You can now easily issue &lt;code&gt;wg-quick up wg0&lt;/code&gt; and &lt;code&gt;wg-quick down wg0&lt;/code&gt;.&lt;br&gt;
To have it start at boot-time issue &lt;code&gt;systemctl enable wg-quick@wg0&lt;/code&gt;. (make sure you stop it first manually before starting the&amp;nbsp;service)&lt;/p&gt;
&lt;h1&gt;Android&amp;nbsp;peer&lt;/h1&gt;
&lt;p&gt;Once you have Dynamic &lt;span class="caps"&gt;DNS&lt;/span&gt; set up on your Android using &lt;a href="https://play.google.com/store/apps/details?id=com.icecoldapps.dynamicdnsupdate"&gt;this app&lt;/a&gt;,&lt;/p&gt;
&lt;h2&gt;Android app&amp;nbsp;setup&lt;/h2&gt;
&lt;p&gt;Install the &lt;a href="https://play.google.com/store/apps/details?id=com.wireguard.android"&gt;Wireguard Android app&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The configuration is pretty straight-forward, but maybe just choose a different port than the one for your laptop, in case you are on the same&amp;nbsp;network.&lt;/p&gt;
&lt;p&gt;On the &lt;code&gt;allowed-ips&lt;/code&gt; section, specify &amp;#8216;0.0.0.0/0. ::0/0&amp;#8217; if you want to forward all internet traffic over this &lt;span class="caps"&gt;VPN&lt;/span&gt; (recommended for public&amp;nbsp;WiFi).&lt;/p&gt;
&lt;h2&gt;Add peer configuration on the&amp;nbsp;server&lt;/h2&gt;
&lt;p&gt;I added this Peer configuration to the existing &lt;code&gt;wg0.conf&lt;/code&gt; file on the&amp;nbsp;Server:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;[Peer]&lt;/span&gt;
&lt;span class="c1"&gt;#mobile&lt;/span&gt;
&lt;span class="na"&gt;PublicKey&lt;/span&gt;           &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;lt;android-public-key&amp;gt;&lt;/span&gt;
&lt;span class="na"&gt;AllowedIPs&lt;/span&gt;          &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;10.0.0.3/32&lt;/span&gt;
&lt;span class="na"&gt;Endpoint&lt;/span&gt;            &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;server.dyndns.com:51821&lt;/span&gt;
&lt;span class="na"&gt;PersistentKeepalive&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;25&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;When forwarding traffic to the outside, make sure &lt;span class="caps"&gt;IP&lt;/span&gt; forwarding is&amp;nbsp;on.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sysctl net.ipv4.ip_forward&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;Additional&amp;nbsp;settings&lt;/h1&gt;
&lt;p&gt;To have the port and masquerading be set up automatically whenever I bring up the wireguard interface, I added soem &lt;code&gt;PostUp&lt;/code&gt; and &lt;code&gt;PostDown&lt;/code&gt; commands.&lt;/p&gt;
&lt;p&gt;My Interface Settings on the server are as&amp;nbsp;follows;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;[Interface]&lt;/span&gt;
&lt;span class="na"&gt;Address&lt;/span&gt;    &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;10.0.0.1/24&lt;/span&gt;
&lt;span class="na"&gt;PostUp&lt;/span&gt;     &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;firewall-cmd --add-port 51820/udp &amp;amp;&amp;amp; firewall-cmd --add-rich-rule=&amp;#39;rule family=ipv4 source address=10.0.0.0/24 masquerade&amp;#39;&lt;/span&gt;
&lt;span class="na"&gt;PostDown&lt;/span&gt;   &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;firewall-cmd --remove-port 51820/udp &amp;amp;&amp;amp; firewall-cmd --remove-rich-rule=&amp;#39;rule family=ipv4 source address=10.0.0.0/24 masquerade&amp;#39;&lt;/span&gt;
&lt;span class="na"&gt;ListenPort&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;51820&lt;/span&gt;
&lt;span class="na"&gt;PrivateKey&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;lt;private-key&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now you can enjoy a very fast and easy to maintain &lt;span class="caps"&gt;VPN&lt;/span&gt; configuration on the road, whether it&amp;#8217;s on your mobile or on your&amp;nbsp;laptop.&lt;/p&gt;
&lt;h1&gt;More&amp;nbsp;Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Wireguard docs for &lt;a href="https://www.wireguard.com/install/"&gt;installation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Wireguard docs for &lt;a href="https://www.wireguard.com/install/"&gt;QuickStart&amp;nbsp;setup&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://wiki.archlinux.org/index.php/WireGuard"&gt;Arch Wiki&lt;/a&gt; was really helpful, as&amp;nbsp;always.&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.rootusers.com/how-to-use-firewalld-rich-rules-and-zones-for-filtering-and-nat/"&gt;Blog post&lt;/a&gt; on firewalld, scroll down to&amp;nbsp;masquerading &lt;/li&gt;
&lt;/ul&gt;</content><category term="fedora"></category><category term="security"></category><category term="vpn"></category></entry><entry><title>ownCloud 9.1 upgrade on FreeNAS</title><link href="https://blog.airey.be/owncloud-91-upgrade-freenas.html" rel="alternate"></link><published>2016-11-18T14:21:00+01:00</published><updated>2016-11-21T00:13:00+01:00</updated><author><name>Andy Airey</name></author><id>tag:blog.airey.be,2016-11-18:/owncloud-91-upgrade-freenas.html</id><summary type="html">&lt;p&gt;Did the upgrade to 9.1 give you a broken setup too? Here is a small guide to resolve&amp;nbsp;it.&lt;/p&gt;</summary><content type="html">&lt;p&gt;Hello&amp;nbsp;there.&lt;/p&gt;
&lt;p&gt;I updated my ownCloud FreeNAS plugin to the latest&amp;nbsp;version.&lt;/p&gt;
&lt;p&gt;After that I did not get my login page back, but I had to continue doing the update manually through the &lt;span class="caps"&gt;CLI&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;Below are the steps I&amp;nbsp;took.&lt;/p&gt;
&lt;p&gt;This might help other people using ownCloud on&amp;nbsp;FreeNAS/FreeBSD.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;First log in to your FreeNAS box and enter the correct&amp;nbsp;jail&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;jls
jexec &lt;span class="m"&gt;4&lt;/span&gt; tcsh    &lt;span class="c1"&gt;# in my case jail number 4 was ownCloud&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Then you should go to the owncloud install&amp;nbsp;directory&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; /usr/pbi/owncloud-amd64/www/owncloud
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Now the following command should be run to conclude the upgrade process (see the official &lt;a href="https://doc.owncloud.org/server/9.1/admin_manual/configuration_server/occ_command.html#command-line-upgrade"&gt;docs&lt;/a&gt;).
   On FreeBSD it is a little&amp;nbsp;different:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;su -m www -c &lt;span class="s1"&gt;&amp;#39;php occ upgrade&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;That will give you a bunch of errors, the problem is that php and it&amp;#8217;s dependencies are not installed.
   Here are all the dependencies I had to&amp;nbsp;install:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pkg install php56 php56-ctype php56-gd php56-xmlreader php56-xml php56-zip php56-xmlwriter php56-curl &lt;span class="se"&gt;\&lt;/span&gt;
            php56-zlib php56-hash php56-mbstring php56-posix php56-pdo php56-sqlite3 php56-pdo_sqlite &lt;span class="se"&gt;\&lt;/span&gt;
            php56-json php56-simplexml
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;After that I could run the upgrade command without and I got my login prompt&amp;nbsp;back!&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Disclaimer: I am not a FreeBSD expert, so there might be a cleaner way to do&amp;nbsp;this.&lt;/p&gt;
&lt;p&gt;I found it really weird that I had to install php56 after a plain update of the ownCloud pbi&amp;nbsp;&amp;#8230;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Update:&lt;/strong&gt; There is now an &lt;a href="https://forums.freenas.org/index.php?threads/new-plugins-for-freenas-9-november-2016-nextcloud-madsonic-resilio-nzbhydra.47259/"&gt;official NextCloud plugin for FreeNAS&lt;/a&gt;, we should all be using that now. Here&amp;#8217;s &lt;a href="http://www.techrepublic.com/article/owncloud-founder-has-forked-their-product-into-nextcloud/"&gt;why&lt;/a&gt;.&lt;/p&gt;</content><category term="owncloud"></category><category term="freenas"></category><category term="upgrade"></category></entry><entry><title>VirtualBox on a SecureBoot enabled system</title><link href="https://blog.airey.be/secureboot-virtualbox.html" rel="alternate"></link><published>2016-10-06T13:27:00+02:00</published><updated>2016-10-17T13:30:00+02:00</updated><author><name>Andy Airey</name></author><id>tag:blog.airey.be,2016-10-06:/secureboot-virtualbox.html</id><summary type="html">&lt;p&gt;Installing VirtualBox on a SecureBoot enabled system can be tedious. Here I explain how to sign the kernel modules so that you can load them into the&amp;nbsp;kernel.&lt;/p&gt;</summary><content type="html">&lt;p&gt;Hello&amp;nbsp;again,&lt;/p&gt;
&lt;p&gt;Apparently the kernel modules that Oracle provide for VirtualBox &lt;a href="https://gorka.eguileor.com/vbox-vmware-in-secureboot-linux/"&gt;are not signed&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;When starting &lt;code&gt;virtualbox&lt;/code&gt; you will get an error that the modules are not&amp;nbsp;loaded.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;WARNING&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;The&lt;/span&gt; &lt;span class="n"&gt;vboxdrv&lt;/span&gt; &lt;span class="n"&gt;kernel&lt;/span&gt; &lt;span class="n"&gt;module&lt;/span&gt; &lt;span class="k"&gt;is&lt;/span&gt; &lt;span class="n"&gt;not&lt;/span&gt; &lt;span class="n"&gt;loaded&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="n"&gt;Either&lt;/span&gt; &lt;span class="n"&gt;there&lt;/span&gt; &lt;span class="k"&gt;is&lt;/span&gt; &lt;span class="n"&gt;no&lt;/span&gt; &lt;span class="n"&gt;module&lt;/span&gt;
         &lt;span class="n"&gt;available&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;current&lt;/span&gt; &lt;span class="n"&gt;kernel&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;4.7&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;200&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;fc24&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;x86_64&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;or&lt;/span&gt; &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="n"&gt;failed&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt;
         &lt;span class="n"&gt;load&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="n"&gt;Please&lt;/span&gt; &lt;span class="n"&gt;recompile&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;kernel&lt;/span&gt; &lt;span class="n"&gt;module&lt;/span&gt; &lt;span class="n"&gt;and&lt;/span&gt; &lt;span class="n"&gt;install&lt;/span&gt; &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="n"&gt;by&lt;/span&gt;

           &lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="sr"&gt;/sbin/&lt;/span&gt;&lt;span class="n"&gt;vboxconfig&lt;/span&gt;

         &lt;span class="n"&gt;You&lt;/span&gt; &lt;span class="n"&gt;will&lt;/span&gt; &lt;span class="n"&gt;not&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;able&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;start&lt;/span&gt; &lt;span class="n"&gt;VMs&lt;/span&gt; &lt;span class="n"&gt;until&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt; &lt;span class="n"&gt;problem&lt;/span&gt; &lt;span class="k"&gt;is&lt;/span&gt; &lt;span class="n"&gt;fixed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;When you run &lt;code&gt;sudo /sbin/vboxconfig&lt;/code&gt;, it will take very long and eventually&amp;nbsp;fail.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;vboxdrv.sh: Building VirtualBox kernel modules.
vboxdrv.sh: Starting VirtualBox services.
vboxdrv.sh: Building VirtualBox kernel modules.
vboxdrv.sh: failed: modprobe vboxdrv failed. Please use &amp;#39;dmesg&amp;#39; to find out why.

There were problems setting up VirtualBox.  To re-start the set-up process, run
  /sbin/vboxconfig
as root.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;So we can sign them ourselves and load them into the&amp;nbsp;kernel.&lt;/p&gt;
&lt;p&gt;The only downside is you have to do this after every kernel&amp;nbsp;update.&lt;/p&gt;
&lt;p&gt;So I wrote a little script to simplify that for me.
This was done on Fedora 23 and 24&amp;nbsp;Workstation.&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;1
2
3
4
5
6
7&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;KERNEL_VERSION&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;uname -r&lt;span class="k"&gt;)&lt;/span&gt;
openssl req -new -x509 -newkey rsa:2048 -keyout MOK_&lt;span class="nv"&gt;$KERNEL_VERSION&lt;/span&gt;.priv -outform DER -out MOK_&lt;span class="nv"&gt;$KERNEL_VERSION&lt;/span&gt;.der -nodes -days &lt;span class="m"&gt;36500&lt;/span&gt; -subj &lt;span class="s2"&gt;&amp;quot;/CN=&lt;/span&gt;&lt;span class="nv"&gt;$KERNEL_VERSION&lt;/span&gt;&lt;span class="s2"&gt;/&amp;quot;&lt;/span&gt;
sudo /usr/src/kernels/&lt;span class="nv"&gt;$KERNEL_VERSION&lt;/span&gt;/scripts/sign-file sha256 ./MOK_&lt;span class="nv"&gt;$KERNEL_VERSION&lt;/span&gt;.priv ./MOK_&lt;span class="nv"&gt;$KERNEL_VERSION&lt;/span&gt;.der &lt;span class="k"&gt;$(&lt;/span&gt;sudo modinfo -n vboxdrv&lt;span class="k"&gt;)&lt;/span&gt;
sudo /usr/src/kernels/&lt;span class="nv"&gt;$KERNEL_VERSION&lt;/span&gt;/scripts/sign-file sha256 ./MOK_&lt;span class="nv"&gt;$KERNEL_VERSION&lt;/span&gt;.priv ./MOK_&lt;span class="nv"&gt;$KERNEL_VERSION&lt;/span&gt;.der &lt;span class="k"&gt;$(&lt;/span&gt;sudo modinfo -n vboxnetflt&lt;span class="k"&gt;)&lt;/span&gt;
sudo /usr/src/kernels/&lt;span class="nv"&gt;$KERNEL_VERSION&lt;/span&gt;/scripts/sign-file sha256 ./MOK_&lt;span class="nv"&gt;$KERNEL_VERSION&lt;/span&gt;.priv ./MOK_&lt;span class="nv"&gt;$KERNEL_VERSION&lt;/span&gt;.der &lt;span class="k"&gt;$(&lt;/span&gt;sudo modinfo -n vboxnetadp&lt;span class="k"&gt;)&lt;/span&gt;
sudo /usr/src/kernels/&lt;span class="nv"&gt;$KERNEL_VERSION&lt;/span&gt;/scripts/sign-file sha256 ./MOK_&lt;span class="nv"&gt;$KERNEL_VERSION&lt;/span&gt;.priv ./MOK_&lt;span class="nv"&gt;$KERNEL_VERSION&lt;/span&gt;.der &lt;span class="k"&gt;$(&lt;/span&gt;sudo modinfo -n vboxpci&lt;span class="k"&gt;)&lt;/span&gt;
sudo mokutil --import MOK_&lt;span class="nv"&gt;$KERNEL_VERSION&lt;/span&gt;.der
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;

&lt;p&gt;So basicly you will have to&amp;nbsp;do:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo dnf update -y &amp;amp;&amp;amp; sudo systemctl reboot     # update kernel
~/bin/mokutil.sh                                # run script against new kernel
sudo reboot                                     # reboot and follow the signing process at boot time
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;After the reboot you can then check the logs if the module was loaded with the following&amp;nbsp;commands:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo keyctl list %:.system_keyring
dmesg | grep &amp;#39;EFI: Loaded cert&amp;#39;
&lt;/pre&gt;&lt;/div&gt;</content><category term="security"></category><category term="fedora"></category><category term="virtualisation"></category><category term="kernel"></category></entry><entry><title>certbot renew on FreeBSD</title><link href="https://blog.airey.be/certbot-renew-freebsd.html" rel="alternate"></link><published>2016-08-17T22:27:00+02:00</published><updated>2016-08-17T23:30:00+02:00</updated><author><name>Andy Airey</name></author><id>tag:blog.airey.be,2016-08-17:/certbot-renew-freebsd.html</id><summary type="html">&lt;p&gt;A small post on how to renew a LetsEncrypt certificate in a FreeBSD&amp;nbsp;jail&lt;/p&gt;</summary><content type="html">&lt;p&gt;Hi&amp;nbsp;there,&lt;/p&gt;
&lt;p&gt;In &lt;a href="../owncloud-letsencrypt"&gt;my last post&lt;/a&gt; I talked about getting a free certificate fron &lt;a href="https://letsencrypt.org/"&gt;LetsEncrypt&lt;/a&gt; using&amp;nbsp;py27-letsencrypt.&lt;/p&gt;
&lt;p&gt;Turns out I was not using the right package for the job.
The package &lt;a href="https://certbot.eff.org/docs/using.html"&gt;certbot&lt;/a&gt; is available now and this (also Python) is used in favor of &lt;code&gt;py27-letsencrypt&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;I found out when I wanted to renew my&amp;nbsp;certificate:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# letsencrypt renew -d your.domain.org
Currently, the renew verb is only capable of renewing all installed certificates that are due to be renewed; individual domains cannot be specified with this action. If you would like to renew specific certificates, use the certonly command. The renew verb may provide other options for selecting certificates to renew in the future.
root@owncloud_1:~ # letsencrypt renew

-------------------------------------------------------------------------------
Processing /usr/local/etc/letsencrypt/renewal/your.domain.org.conf
-------------------------------------------------------------------------------

-------------------------------------------------------------------------------
The program httpd (process ID 12020) is already listening on TCP port 80. This
will prevent us from binding to that port. Please stop the httpd program
temporarily and then try again. For automated renewal, you may want to use a
script that stops and starts your webserver. You can find an example at
https://letsencrypt.org/howitworks/#writing-your-own-renewal-script.
Alternatively you can use the webroot plugin to renew without needing to stop
and start your webserver.
-------------------------------------------------------------------------------
2016-08-17 20:54:09,442:WARNING:letsencrypt.renewal:Attempting to renew cert from /usr/local/etc/letsencrypt/renewal/your.domain.org.conf produced an unexpected error: At least one of the (possibly) required ports is already taken.. Skipping.

All renewal attempts failed. The following certs could not be renewed:
  /usr/local/etc/letsencrypt/live/your.domain.org/fullchain.pem (failure)
1 renew failure(s), 0 parse failure(s)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Due to the first error, I wondered if my version was out of&amp;nbsp;date.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pkg update
pkg upgrade
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Yes there was an update, but after the upgrade it was even&amp;nbsp;worse:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# letsencrypt renew --certonly&lt;/span&gt;
&lt;span class="n"&gt;Traceback&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;most&lt;/span&gt; &lt;span class="n"&gt;recent&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt; &lt;span class="n"&gt;last&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/usr/local/bin/letsencrypt&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;pkg_resources&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;load_entry_point&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/usr/local/lib/python2.7/site-packages/pkg_resources/__init__.py&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;2927&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="nd"&gt;@_call_aside&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/usr/local/lib/python2.7/site-packages/pkg_resources/__init__.py&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;2913&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;_call_aside&lt;/span&gt;
    &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/usr/local/lib/python2.7/site-packages/pkg_resources/__init__.py&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;2940&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;_initialize_master_working_set&lt;/span&gt;
    &lt;span class="n"&gt;working_set&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;WorkingSet&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_build_master&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/usr/local/lib/python2.7/site-packages/pkg_resources/__init__.py&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;637&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;_build_master&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;cls&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_build_from_requirements&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;__requires__&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/usr/local/lib/python2.7/site-packages/pkg_resources/__init__.py&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;650&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;_build_from_requirements&lt;/span&gt;
    &lt;span class="n"&gt;dists&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ws&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;resolve&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;reqs&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Environment&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/usr/local/lib/python2.7/site-packages/pkg_resources/__init__.py&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;829&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;resolve&lt;/span&gt;
    &lt;span class="k"&gt;raise&lt;/span&gt; &lt;span class="n"&gt;DistributionNotFound&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;req&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;requirers&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;pkg_resources&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DistributionNotFound&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;The&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;acme==0.5.0&amp;#39;&lt;/span&gt; &lt;span class="n"&gt;distribution&lt;/span&gt; &lt;span class="n"&gt;was&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;found&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="n"&gt;required&lt;/span&gt; &lt;span class="n"&gt;by&lt;/span&gt; &lt;span class="n"&gt;letsencrypt&lt;/span&gt;
&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="nd"&gt;@owncloud_1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt; &lt;span class="c1"&gt;# letsencrypt&lt;/span&gt;
&lt;span class="n"&gt;Traceback&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;most&lt;/span&gt; &lt;span class="n"&gt;recent&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt; &lt;span class="n"&gt;last&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/usr/local/bin/letsencrypt&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;pkg_resources&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;load_entry_point&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/usr/local/lib/python2.7/site-packages/pkg_resources/__init__.py&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;2927&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="nd"&gt;@_call_aside&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/usr/local/lib/python2.7/site-packages/pkg_resources/__init__.py&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;2913&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;_call_aside&lt;/span&gt;
    &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/usr/local/lib/python2.7/site-packages/pkg_resources/__init__.py&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;2940&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;_initialize_master_working_set&lt;/span&gt;
    &lt;span class="n"&gt;working_set&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;WorkingSet&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_build_master&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/usr/local/lib/python2.7/site-packages/pkg_resources/__init__.py&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;637&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;_build_master&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;cls&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_build_from_requirements&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;__requires__&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/usr/local/lib/python2.7/site-packages/pkg_resources/__init__.py&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;650&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;_build_from_requirements&lt;/span&gt;
    &lt;span class="n"&gt;dists&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ws&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;resolve&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;reqs&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Environment&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/usr/local/lib/python2.7/site-packages/pkg_resources/__init__.py&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;829&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;resolve&lt;/span&gt;
    &lt;span class="k"&gt;raise&lt;/span&gt; &lt;span class="n"&gt;DistributionNotFound&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;req&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;requirers&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;pkg_resources&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DistributionNotFound&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;The&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;acme==0.5.0&amp;#39;&lt;/span&gt; &lt;span class="n"&gt;distribution&lt;/span&gt; &lt;span class="n"&gt;was&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;found&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="n"&gt;required&lt;/span&gt; &lt;span class="n"&gt;by&lt;/span&gt; &lt;span class="n"&gt;letsencrypt&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;After some googling, it seemed I needed letsencrypt-auto or certbot-auto, both not available through the package manager in FreeBSD. So not really my&amp;nbsp;preference.&lt;/p&gt;
&lt;p&gt;I found &lt;a href="https://certbot.eff.org/all-instructions/#freebsd-apache"&gt;this page&lt;/a&gt; so I installed plain&amp;nbsp;certbot&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pkg search certbot
pkg install certbot
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Turns out this was requiring the same &lt;code&gt;acme&lt;/code&gt; dependency and&amp;nbsp;version:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# certbot
An unexpected error occurred:
VersionConflict: (acme 0.8.1 (/usr/local/lib/python2.7/site-packages), Requirement.parse(&amp;#39;acme==0.5.0&amp;#39;))
Please see the logfile &amp;#39;certbot.log&amp;#39; for more details.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;I then found &lt;a href="https://github.com/certbot/certbot/issues/3221"&gt;this solution&lt;/a&gt; and uninstalled it with &lt;code&gt;pip&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pip uninstall letsencrypt
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;I could then do a renew &lt;a href="https://certbot.eff.org/docs/using.html"&gt;as follows&lt;/a&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# certbot renew --dry-run

-------------------------------------------------------------------------------
Processing /usr/local/etc/letsencrypt/renewal/your.domain.org.conf
-------------------------------------------------------------------------------

-------------------------------------------------------------------------------
The program httpd (process ID 12020) is already listening on TCP port 80. This
will prevent us from binding to that port. Please stop the httpd program
temporarily and then try again. For automated renewal, you may want to use a
script that stops and starts your webserver. You can find an example at
https://letsencrypt.org/howitworks/#writing-your-own-renewal-script.
Alternatively you can use the webroot plugin to renew without needing to stop
and start your webserver.
-------------------------------------------------------------------------------
2016-08-17 21:52:47,093:WARNING:certbot.renewal:Attempting to renew cert from /usr/local/etc/letsencrypt/renewal/your.domain.org.conf produced an unexpected error: At least one of the (possibly) required ports is already taken.. Skipping.
** DRY RUN: simulating &amp;#39;certbot renew&amp;#39; close to cert expiry
**          (The test certificates below have not been saved.)

All renewal attempts failed. The following certs could not be renewed:
  /usr/local/etc/letsencrypt/live/your.domain.org/fullchain.pem (failure)
** DRY RUN: simulating &amp;#39;certbot renew&amp;#39; close to cert expiry
**          (The test certificates above have not been saved.)
1 renew failure(s), 0 parse failure(s)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;So it tries to run it&amp;#8217;s own webserver and auto-approve the renewal this way by connecting to it.
This is of course not possible when Apache is running and using the same port on the system.
It is possible to specify a &lt;a href="https://community.letsencrypt.org/t/le-client-needs-to-bind-to-port-80-which-im-already-using/2739/10"&gt;different port&lt;/a&gt;, but then you need to set up a &lt;span class="caps"&gt;NAT&lt;/span&gt;/Proxy rule to this port so that it is accessible through standard &lt;span class="caps"&gt;HTTP&lt;/span&gt; on port&amp;nbsp;80.&lt;/p&gt;
&lt;p&gt;This is not a production server so I wrapped it with these hooks (as&amp;nbsp;recommended):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;certbot renew --standalone --pre-hook &amp;quot;/usr/pbi/owncloud-amd64/etc/rc.d/apache24 stop&amp;quot; --post-hook &amp;quot;/usr/pbi/owncloud-amd64/etc/rc.d/apache24 start&amp;quot; --dry-run
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The dry-run was succesful! (in retrospect - could&amp;#8217;ve done this with the original &lt;code&gt;py27-letsencrypt&lt;/code&gt; too &amp;#8230;)
Finally, I set up crontab to take care of this for me in the&amp;nbsp;future:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;0 3 1 */3 * root certbot renew --standalone --pre-hook &amp;quot;/usr/pbi/owncloud-amd64/etc/rc.d/apache24 stop&amp;quot; --post-hook &amp;quot;/usr/pbi/owncloud-amd64/etc/rc.d/apache24 start&amp;quot;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;This will check and renew the cert every 3 (1st of Jan, Apr, Jul,&amp;nbsp;Oct).&lt;/p&gt;
&lt;p&gt;Future-you will thank&amp;nbsp;you!&lt;/p&gt;</content><category term="owncloud"></category><category term="security"></category><category term="letsencrypt"></category><category term="freenas"></category><category term="cerbot"></category><category term="jails"></category></entry><entry><title>letsencrypt and OwnCloud</title><link href="https://blog.airey.be/owncloud-letsencrypt.html" rel="alternate"></link><published>2016-07-07T22:20:00+02:00</published><updated>2016-08-01T23:52:00+02:00</updated><author><name>Andy Airey</name></author><id>tag:blog.airey.be,2016-07-07:/owncloud-letsencrypt.html</id><summary type="html">&lt;p&gt;A small post on how to set up ownCloud to use a letsencrypt certificate within a FreeNAS&amp;nbsp;jail&lt;/p&gt;</summary><content type="html">&lt;p&gt;Hello&amp;nbsp;there.&lt;/p&gt;
&lt;p&gt;Recently I was in the need of an &lt;span class="caps"&gt;SSL&lt;/span&gt; certificate for my personal &lt;a href="https://owncloud.org/"&gt;ownCloud&lt;/a&gt; server.
On my setup, ownCloud runs as a &lt;a href="https://doc.freenas.org/9.10/freenas_plugins.html#installing-plugins"&gt;plugin for FreeNAS 9.10&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;At the time of writing &lt;a href="https://letsencrypt.org/2016/04/12/leaving-beta-new-sponsors.html"&gt;letsencrypt was out of beta&lt;/a&gt; for some months and I decided to give it a go.
I&amp;#8217;ve had good experience with &lt;a href="https://www.startssl.com/"&gt;StartSSL&lt;/a&gt; and their free certificate for one hostname, but I&amp;#8217;ve been following the letsencrypt developments and I really stand behind what they are&amp;nbsp;doing.&lt;/p&gt;
&lt;p&gt;I have to say I was somewhat surprised by the results. It was really easy to set up and the certificate was trusted, no problem. Even &lt;a href="https://www.ssllabs.com/"&gt;&lt;span class="caps"&gt;SSL&lt;/span&gt; Labs&lt;/a&gt; didn&amp;#8217;t complain&amp;nbsp;:).&lt;/p&gt;
&lt;p&gt;Here&amp;#8217;s how I did&amp;nbsp;it.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;On your FreeNAS host, find out which jail is runing owncloud and enter&amp;nbsp;it:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;jls
jexec &lt;span class="m"&gt;3&lt;/span&gt; tcsh
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Install the needed packages within this&amp;nbsp;jail:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pkg install py27-letsencrypt
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Stop apache and start the setup&amp;nbsp;wizard:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/usr/pbi/owncloud-amd64/etc/rc.d/apache24 stop
letsencrypt certonly
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Softlink the new certs from the apache directory (replace your.domain.org with the domain name from step&amp;nbsp;3)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/usr/pbi/owncloud-amd64/etc/rc.d/apache24 start
&lt;span class="nb"&gt;cd&lt;/span&gt; /usr/pbi/owncloud-amd64/etc/apache24/
ln -s /usr/local/etc/letsencrypt/live/your.domain.org/cert.pem letsencrypt.crt
ln -s /usr/local/etc/letsencrypt/live/your.domain.org/privkey.pem letsencrypt.key
ln -s /usr/local/etc/letsencrypt/live/your.domain.org/chain.pem letsencrypt_chain.crt
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;edit &lt;code&gt;extra/httpd-ssl.conf&lt;/code&gt; and change it so&amp;nbsp;that&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;1
2
3
4
5
6
7&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;SSLProtocol&lt;/span&gt; &lt;span class="k"&gt;all&lt;/span&gt; -SSLv2 -SSLv3
&lt;span class="nb"&gt;SSLHonorCipherOrder&lt;/span&gt; &lt;span class="k"&gt;on&lt;/span&gt;
&lt;span class="nb"&gt;SSLCipherSuite&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;EECDH+ECDSA+AESGCM EECDH+aRSA+AESGCM EECDH+ECDSA+SHA384 EECDH+ECDSA+SHA256 EECDH+aRSA+SHA384 EECDH+aRSA+SHA256 EECDH+aRSA+RC4 EECDH EDH+aRSA RC4 !aNULL !eNULL !LOW !3DES !MD5 !EXP !PSK !SRP !DSS&amp;quot;&lt;/span&gt;

&lt;span class="nb"&gt;SSLCertificateFile&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/usr/pbi/owncloud-amd64/etc/apache24/letsencrypt.crt&amp;quot;&lt;/span&gt;
&lt;span class="nb"&gt;SSLCertificateKeyFile&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/usr/pbi/owncloud-amd64/etc/apache24/letsencrypt.key&amp;quot;&lt;/span&gt;
&lt;span class="nb"&gt;SSLCACertificateFile&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/usr/pbi/owncloud-amd64/etc/apache24/letsencrypt_chain.crt&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;

&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Restart Apache &lt;span class="caps"&gt;HTTPD&lt;/span&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;../rc.d/apache24 restart
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Check the logs for&amp;nbsp;errors:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;tail /var/log/httpd-error.log
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ol&gt;</content><category term="owncloud"></category><category term="security"></category><category term="letsencrypt"></category><category term="freenas"></category></entry><entry><title>My First Post</title><link href="https://blog.airey.be/first-post.html" rel="alternate"></link><published>2016-07-06T00:49:00+02:00</published><updated>2016-07-06T00:49:00+02:00</updated><author><name>Andy Airey</name></author><id>tag:blog.airey.be,2016-07-06:/first-post.html</id><summary type="html">&lt;p&gt;First Post to this&amp;nbsp;blog&lt;/p&gt;</summary><content type="html">&lt;p&gt;So, my first post on this&amp;nbsp;blog.&lt;/p&gt;
&lt;p&gt;Let&amp;#8217;s not make any promises here, but a frequency of one post a month would already be high above my expectations of myself.&amp;nbsp;:)&lt;/p&gt;
&lt;p&gt;As some may know I&amp;#8217;ve tried a few other blogs but gave up on writing.
Let&amp;#8217;s see where this takes us&amp;nbsp;&amp;#8230;&lt;/p&gt;
&lt;p&gt;I chose pelican as a static site generator because it uses Python.
I preferred this over Jekyll&amp;#8217;s Ruby for&amp;nbsp;example.&lt;/p&gt;
&lt;p&gt;If you&amp;#8217;re interested in my setup, I basicly did something similar to &lt;a href="https://fedoramagazine.org/make-github-pages-blog-with-pelican/"&gt;this&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;That&amp;#8217;s all for now.
See you&amp;nbsp;around!&lt;/p&gt;</content><category term="pelican"></category><category term="python"></category></entry></feed>